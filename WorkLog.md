# 记录一下机械臂制作过程，碰到的困难问题和挑战

## 电机

### 2024-05-10
在代码里测试了GPIO，ADC都没问题，但是SPI的NSS引脚PA4一直没有信号，我在代码中设置了每次SPI通信前将PA4置低电平开启MT6816，通信完置高电平关闭。
通过逻辑分析仪抓取发现NSS PA4引脚一直是低电平，代码中将PA4换成其他引脚PB8最为对照，然后测PB8引脚能抓到和代码吻合的电平变化，证明逻辑代码没问题。
最后将PA4引脚功能从SPI_NSS换成GPIO输出，然后问题就搞定了，从MT6816读取的数据很稳定，不飘，手按住电机转子稍微用力旋转，即使是弹性转动也能探测到数据变化，
松手数据也会回弹到之前的数据，证明电路设计也没有问题。接下来可以测试电机转动了。

#### 
[42步进电机接线](https://www.bilibili.com/read/cv5637376/)
- 判断哪两个引脚是一组线圈可以用万用表测电阻，如果电阻很小那么就是一组线圈
- 电流控制扭矩

### 2024-05-11
- 使用基本的8 step比较丝滑的电机正反转，至此所有的底层功能，外设都验证完成（DMA还没专门验证，不过应该没问题）。唯一一个例外是温敏电阻VCC搞错了，设置成了12v导致之前芯片引脚电压不对，所以温敏电阻adc读取的值无效，之后在新版本中修改。

- 研究怎么将底层硬件配置完全抽象出来，用c++ class封装一遍，保证上层软件和底层硬件配置解耦，方便以后灵活修改底层配置。

### 2024-05-12
- 将底层基本外设都剥离到单独的c文件，然后开始将c文件里的功能函数抽象出来提供给上层C++ class。比如adc.hpp 中的adc class 调用adc.c 的函数，此外，使用inline内联避免多次函数调用的额外开销。
